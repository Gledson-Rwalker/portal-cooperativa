{% extends "layout.html" %}

{% block title %}Lista de Cooperados Cadastrados{% endblock %}

{% block content %}
<div class="container">
    <div class="header">
        <h2>Cooperados Cadastrados</h2>
        <div>
            <!-- --- NOVO BOTÃO AQUI --- -->
            <a href="{{ url_for('add_cooperado_page') }}" class="btn btn-success">Adicionar Cooperado</a>
        </div>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">Voltar ao Painel</a>
    </div>
    <p>Total de cooperados na base: <strong>{{ cooperados|length }}</strong></p>
    
    <div class="form-group">
        <label for="searchInput">Buscar por Nome ou CPF:</label>
        <input type="text" id="searchInput" class="form-control" onkeyup="filterTable()" placeholder="Digite para buscar...">
    </div>
    
    <table class="table" id="cooperadosTable">
        <thead>
            <tr>
                <th>Nome Completo</th>
                <th>CPF</th>
                <th>Email</th>
                <th>Perfil Completo?</th>
                <!-- --- NOVA COLUNA AQUI --- -->
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for cooperado in cooperados %}
            <tr>
                <!-- O nome agora é apenas texto, sem link -->
                <td>{{ cooperado.nome }}</td>
                <td>{{ cooperado.cpf }}</td>
                <td>{{ cooperado.email }}</td>
                <td>
                    {% if cooperado.perfil_completo %}
                        <span class="badge bg-success">Sim</span>
                    {% else %}
                        <span class="badge bg-danger">Não</span>
                    {% endif %}
                </td>
                <!-- --- NOVO BOTÃO AQUI --- -->
                <td>
                    <a href="{{ url_for('detalhe_cooperado', cpf=cooperado.cpf) }}" class="btn btn-sm btn-info">Perfil</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- O JavaScript do filtro continua o mesmo -->
<script>
function filterTable() {
    const input = document.getElementById("searchInput");
    // 1. Limpa o termo de busca, removendo pontos, hífens e espaços
    const filter = input.value.toUpperCase().replace(/[.\-\s]/g, '');
    const table = document.getElementById("cooperadosTable");
    const tr = table.getElementsByTagName("tr");

    for (let i = 1; i < tr.length; i++) { // Começa em 1 para pular o cabeçalho
        let tdNome = tr[i].getElementsByTagName("td")[0];
        let tdCpf = tr[i].getElementsByTagName("td")[1];
        if (tdNome || tdCpf) {
            // 2. Pega o texto do nome e do CPF da tabela
            let nomeText = tdNome.textContent || tdNome.innerText;
            let cpfText = tdCpf.textContent || tdCpf.innerText;

            // 3. Limpa o CPF da tabela também, para uma comparação justa
            let cpfSanitized = cpfText.replace(/[.\-\s]/g, '');

            // 4. Combina o nome e o CPF limpo para a busca
            let txtValue = nomeText.toUpperCase() + " " + cpfSanitized;

            if (txtValue.indexOf(filter) > -1) {
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }       
    }
}
</script>
{% endblock %}